(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,l,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(1087)}])},1087:function(e,l,n){"use strict";n.r(l),n.d(l,{default:function(){return V}});var i=n(5893),s=n(7294),t=n(8901),r=n(8750),a=n(3321),d=n(2963),c=n(5378),o=n(1768),u=n(2280),x=n(8895),h=n(7357),j=n(2797),p=n(4721),m=n(5512),g=n(6895),f=n(5498),v=n(0),Z=n(2014),y=n(3665);let b=["luma709","luma601","maximum","minimum","average","minmax","red","green","blue","cyan","magenta","yellow","black","hue","saturation","lightness"];function w(e){let{image:l,onUpdate:n}=e;return(0,i.jsxs)(u.Z,{disabled:!l,children:[(0,i.jsx)(x.Z,{children:(0,i.jsxs)(h.Z,{sx:{display:"flex",fontWeight:"bold",alignItems:"center",justifyContent:"center",gap:"0.25em"},children:[(0,i.jsx)(y.Z,{}),(0,i.jsx)("span",{children:"Grey Scale"})]})}),(0,i.jsx)(j.Z,{children:b.map(e=>(0,i.jsx)(a.Z,{onClick:()=>n("grey",{algorithm:e}),children:e},e))})]})}var k=n(3330),C=n(5819),S=n(5861),F=n(5929),E=n(5522);function I(e){let{type:l,value:n,checked:i}=e;switch(l){case"checkbox":return i;case"range":case"number":return+(n||0);default:return n}}function A(e){let{disabled:l,image:n,onUpdate:t}=e,r=(0,s.useRef)(null),a=(0,s.useCallback)(()=>{if(!r.current)return null;setTimeout(()=>{let e=Object.fromEntries(Array.from(null==r?void 0:r.current.querySelectorAll("input").values()).map(e=>[e.name,I(e)])),l={radius:e.radius,sigma:e.sigma};t(e.operation,l)})},[]);return(0,i.jsxs)(u.Z,{disabled:!n,children:[(0,i.jsx)(x.Z,{children:(0,i.jsxs)(h.Z,{sx:{display:"flex",fontWeight:"bold",alignItems:"center",justifyContent:"center",gap:"0.25em"},children:[(0,i.jsx)(E.Z,{}),(0,i.jsx)("span",{children:"Blur Filter"})]})}),(0,i.jsx)(j.Z,{children:(0,i.jsxs)("form",{ref:r,children:[(0,i.jsxs)(k.Z,{name:"operation",label:"operation",defaultValue:"gaussianFilter",children:[(0,i.jsx)(C.Z,{value:"medianFilter",children:"Median Filter (slow!!)"}),(0,i.jsx)(C.Z,{value:"blurFilter",children:"Blur Filter (slow!!)"}),(0,i.jsx)(C.Z,{value:"gaussianFilter",children:"Gaussian Filter"})]}),(0,i.jsxs)(h.Z,{display:"flex",gap:5,children:[(0,i.jsx)(S.Z,{children:" Radius "}),(0,i.jsx)(F.ZP,{disabled:l,name:"radius",min:1,max:100,step:1,onChange:a})]}),(0,i.jsxs)(h.Z,{display:"flex",gap:5,children:[(0,i.jsx)(S.Z,{children:" Sigma "}),(0,i.jsx)(F.ZP,{disabled:l,name:"sigma",min:.01,max:100,step:.01,onChange:a})]})]})})]})}var D=n(4422);function R(e){let{disabled:l,image:n,onUpdate:t}=e,r=(0,s.useRef)(null),a=(0,s.useCallback)(()=>{if(!r.current)return null;setTimeout(()=>{let e=Object.fromEntries(Array.from(null==r?void 0:r.current.querySelectorAll("input").values()).map(e=>[e.name,I(e)])),{operation:l,...n}=e;t(l,n)})},[]);return(0,i.jsxs)(u.Z,{disabled:!n||n.components>1,children:[(0,i.jsx)(x.Z,{children:(0,i.jsxs)(h.Z,{sx:{display:"flex",fontWeight:"bold",alignItems:"center",justifyContent:"center",gap:"0.25em"},children:[(0,i.jsx)(D.Z,{}),(0,i.jsx)("span",{children:" Erode/Dilate"})]})}),(0,i.jsx)(j.Z,{children:(0,i.jsxs)("form",{ref:r,children:[(0,i.jsxs)(k.Z,{name:"operation",label:"operation",defaultValue:"erode",children:[(0,i.jsx)(C.Z,{value:"erode",children:"Erode"}),(0,i.jsx)(C.Z,{value:"dilate",children:"Dilate"}),(0,i.jsx)(C.Z,{value:"open",children:"Open (Dilate + Erode)"}),(0,i.jsx)(C.Z,{value:"open",children:"Close (Erode + Dilate)"}),(0,i.jsx)(C.Z,{value:"blackHat",children:"Black Hat"}),(0,i.jsx)(C.Z,{value:"topHat",children:"White Hat"})]}),(0,i.jsxs)(h.Z,{display:"flex",gap:5,children:[(0,i.jsx)(S.Z,{children:" Iterations "}),(0,i.jsx)(F.ZP,{disabled:l,name:"iterations",min:1,max:100,step:1,onChange:a})]})]})})]})}var _=n(281);function M(e){let{disabled:l,image:n,onUpdate:t}=e,r=(0,s.useRef)(null),d=(0,s.useCallback)(()=>{if(!r.current)return null;setTimeout(()=>{let e=Object.fromEntries(Array.from(null==r?void 0:r.current.querySelectorAll("input").values()).map(e=>[e.name,I(e)])),{operation:l,...n}=e,[i,s]=l.split("-");t(i,{...n,direction:s})})},[]);return(0,i.jsxs)(u.Z,{disabled:!n,children:[(0,i.jsx)(x.Z,{children:(0,i.jsxs)(h.Z,{sx:{display:"flex",fontWeight:"bold",alignItems:"center",justifyContent:"center",gap:"0.25em"},children:[(0,i.jsx)(_.Z,{}),(0,i.jsx)("span",{children:" Edge Detection "})]})}),(0,i.jsx)(j.Z,{children:(0,i.jsxs)("form",{ref:r,children:[(0,i.jsxs)(k.Z,{name:"operation",label:"operation",defaultValue:"sobelFilter-xy",children:[(0,i.jsx)(C.Z,{value:"cannyEdge",disabled:(null==n?void 0:n.components)>1,children:"Canny Edge"}),(0,i.jsx)(C.Z,{value:"morphologicalGradient",disabled:(null==n?void 0:n.components)>1,children:"Morphological Gradient"}),(0,i.jsx)(C.Z,{value:"sobelFilter-x",children:"Sobel X"}),(0,i.jsx)(C.Z,{value:"sobelFilter-y",children:"Sobel Y"}),(0,i.jsx)(C.Z,{value:"sobelFilter-xy",children:"Sobel XY"}),(0,i.jsx)(C.Z,{value:"schaarFilter-x",children:"Schaar X"}),(0,i.jsx)(C.Z,{value:"schaarFilter-y",children:"Schaar Y"}),(0,i.jsx)(C.Z,{value:"schaarFilter-xy",children:"Schaar XY"})]}),(0,i.jsx)(a.Z,{disabled:l,onClick:d,children:"Run"})]})})]})}function O(e){return(0,i.jsxs)("div",{children:[(0,i.jsx)(w,{...e}),(0,i.jsx)(A,{...e}),(0,i.jsx)(R,{...e}),(0,i.jsx)(M,{...e})]})}var L=n(4599);let P=e=>"rgb(".concat(e.slice(0,3).map(e=>32*Math.ceil(e/32)).join(","),")");function Y(e){let{image:l}=e,[n,t]=(0,s.useState)({}),r=(null==l?void 0:l.width)*(null==l?void 0:l.height);return(0,i.jsxs)("div",{children:[(0,i.jsx)(a.Z,{onClick:()=>{let e={};for(let n of l.getPixelsArray()){let i=1==l.components,s=i?"rgb(".concat(n[0],",").concat(n[0],",").concat(n[0],")"):P(n);e[s]=e[s]||0,e[s]+=1}t(e)},children:" Histogram"}),(0,i.jsx)("div",{style:{overflowY:"scroll",height:"200px"},children:Object.entries(n).filter(e=>{let[l,n]=e;return n>.001*r}).sort((e,l)=>l[1]-e[1]).map(e=>{let[l,n]=e;return(0,i.jsxs)("div",{style:{display:"flex"},children:[(0,i.jsx)("span",{style:{background:l,width:"1em",height:"1em",display:"block"}}),(0,i.jsxs)("span",{children:[l," = "]}),(0,i.jsxs)("span",{children:[" ",(n/r*100).toFixed(3),"% (",n,") "]})]},l)})})]})}function B(e){var l,n,s,t;let{disabled:r,selected:a,setSelected:d,images:c,onAddFiles:o,update:y}=e,b=null===(l=c[a])||void 0===l?void 0:l.image,w=(null===(s=c[a])||void 0===s?void 0:null===(n=s.next)||void 0===n?void 0:n.image)||b;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(u.Z,{children:[(0,i.jsx)(x.Z,{children:(0,i.jsxs)(h.Z,{style:{display:"flex",alignItems:"center",gap:"0.5em"},children:[(0,i.jsx)(p.Z,{})," Info"]})}),(0,i.jsx)(j.Z,{children:(0,i.jsx)("pre",{children:(0,i.jsx)("code",{children:JSON.stringify({name:null===(t=c[a])||void 0===t?void 0:t.name,meta:null==b?void 0:b.meta,width:null==b?void 0:b.width,height:null==b?void 0:b.height,size:null==b?void 0:b.size,bitDepth:null==b?void 0:b.bitDepth,maxValue:null==b?void 0:b.maxValue,channels:null==b?void 0:b.channels,colorModel:null==b?void 0:b.colorModel},null,2)})})})]}),(0,i.jsxs)(u.Z,{children:[(0,i.jsx)(x.Z,{children:(0,i.jsxs)(h.Z,{style:{display:"flex",alignItems:"center",gap:"0.5em"},children:[(0,i.jsx)(g.Z,{})," Processing"]})}),(0,i.jsx)(j.Z,{children:(0,i.jsx)(O,{disabled:r,image:b,onUpdate:y},a)})]}),(0,i.jsxs)(u.Z,{children:[(0,i.jsx)(x.Z,{children:(0,i.jsxs)(h.Z,{style:{display:"flex",alignItems:"center",gap:"0.5em"},children:[(0,i.jsx)(f.Z,{})," Analyze"]})}),(0,i.jsx)(j.Z,{children:(0,i.jsx)(Y,{image:w},a)})]}),(0,i.jsxs)(u.Z,{children:[(0,i.jsx)(x.Z,{children:(0,i.jsxs)(h.Z,{style:{display:"flex",alignItems:"center",gap:"0.5em"},children:[(0,i.jsx)(m.Z,{})," Files"]})}),(0,i.jsxs)(j.Z,{children:[(0,i.jsx)("div",{children:c.map((e,l)=>(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",padding:"0.5em",margin:"0.5em",border:"solid 1px ".concat(l==a?"red":"black"),justifyContent:"center",alignItems:"center"},children:[(0,i.jsx)("img",{style:{width:"fs"==e.type?"100%":"90%"},src:e.url,onClick:()=>{d(l)}},e.name),(0,i.jsx)("span",{children:e.name})]},e.name+l))}),(0,i.jsx)("div",{style:{marginTop:"2em"},onClick:o,children:(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[(0,i.jsx)(L.Z,{style:{width:"5rem",height:"5rem"}}),(0,i.jsx)("span",{children:"add Image"})]})})]})]}),(0,i.jsxs)(u.Z,{children:[(0,i.jsx)(x.Z,{children:(0,i.jsxs)(h.Z,{style:{display:"flex",alignItems:"center",gap:"0.5em"},children:[(0,i.jsx)(v.Z,{})," Workflows"]})}),(0,i.jsx)(j.Z,{})]}),(0,i.jsxs)(u.Z,{children:[(0,i.jsx)(x.Z,{children:(0,i.jsxs)(h.Z,{style:{display:"flex",alignItems:"center",gap:"0.5em"},children:[(0,i.jsx)(Z.Z,{})," Export"]})}),(0,i.jsx)(j.Z,{})]})]})}function N(e){let{image:l}=e,n=(0,s.useRef)(null),[t,r]=(0,s.useState)(null),[a,d]=(0,s.useState)(1),[[c,o],u]=(0,s.useState)([0,0]);(0,s.useEffect)(()=>(l&&l.toBlob().then(e=>{r(window.URL.createObjectURL(e))}),()=>{t&&window.URL.revokeObjectURL(t)}),[l]);let[x,h]=(0,s.useState)(null);return(0,i.jsx)("div",{ref:n,draggable:!1,style:{gridArea:"c",userSelect:"none",display:"flex",padding:"1em",background:"#eee",overflow:"hidden",position:"relative"},onMouseDown:e=>{if(!n.current)return;let l=e.clientX,i=e.clientY;h([l,i,c,o])},onMouseMove:e=>{if(!x||!n.current)return;let l=e.clientX-x[0],i=e.clientY-x[1];u([l+x[2],i+x[3]])},onMouseUp:()=>h(null),onMouseLeave:()=>h(null),onClick:()=>h(null),onBlur:()=>h(null),onWheel:e=>{d(a+e.deltaY/1e3)},children:(0,i.jsx)("div",{style:{display:"block",position:"absolute",top:"-1000px",left:"-1000px",paddingLeft:"1000px",paddingTop:"1000px",right:"-1000px",bottom:"-1000px",backgroundPosition:"center center",backgroundSize:"20px 20px",transform:"translate(".concat(c,"px, ").concat(o,"px) scale(").concat(a,")"),backgroundImage:"\n              radial-gradient(circle, #000000 1px, rgba(0, 0, 0, 0) 1px),\n              linear-gradient(to right, #ccc 1px, transparent 1px),\n              linear-gradient(to bottom, #ccc 1px, transparent 1px)\n          "},children:t&&(0,i.jsx)("img",{draggable:!1,style:{userSelect:"none",objectFit:"contain"},src:t})})})}var T=n(705),U=n.n(T);function W(e){let{operation:l,data:n,...s}=e;return l?(0,i.jsxs)(a.Z,{...s,children:[l,"(",JSON.stringify(n||{}),")"]}):null}let X=(()=>{if("undefined"==typeof window)return async(e,l,n)=>"";{let e=new Worker(n.tu(new URL(n.p+n.u(102),n.b))),l={};return e.addEventListener("message",e=>{var n;console.log({result:e}),null===(n=l[e.data.hash])||void 0===n||n.call(l,e.data.url)}),async(n,i,s)=>{let t={url:n,operation:i,options:s},r=U()(t);console.log({hash:r,...t}),e.postMessage({hash:r,...t});let a=new Promise(e=>{l[r]=n=>{e(n),delete l[r]}});return a}}})();function H(){var e,l,n,u,x,h,j,p;let[m,g]=(0,s.useState)(0),[f,v]=(0,s.useState)([]),Z=(0,s.useCallback)(async e=>{let l=await Promise.allSettled(e.map(async e=>{let l=await e.arrayBuffer(),n=await r.Ee.load(l),i=n.toDataURL();return{file:e,url:i,image:n}})),n=Array.from(l.values()).map(e=>"fulfilled"!==e.status?null:{type:"fs",name:e.value.file.name,chain:[{parent:null,id:f.length,operation:"fs",data:{input:e.value.file.name}}],...e.value}).filter(Boolean);v(e=>[...e,...n])},[f,m]),{getRootProps:y,getInputProps:b,isDragActive:w}=(0,t.uI)({onDrop:Z}),[k,C]=(0,s.useState)(!1),S=(0,s.useCallback)(async(e,l)=>{if(k)return;let n=f[m];console.log(f,n,m),console.log("update",{url:n.url,operation:e,options:l}),C(!0);try{let i=await X(n.url,e,l),s=await r.Ee.load(i);C(!1),v(t=>{try{let r={...n,next:{url:i,id:m,operation:e,image:s,data:l}};return[...t.slice(0,m),r,...t.slice(m+1)]}catch(e){return console.error(e),t}})}catch(e){console.log(e),C(!1)}},[f.length,m]),F=(null===(l=f[m])||void 0===l?void 0:null===(e=l.next)||void 0===e?void 0:e.image)||(null===(n=f[m])||void 0===n?void 0:n.image),{onClick:E,...I}=y();return(0,i.jsxs)("div",{...I,style:{display:"grid",height:"100vh",grid:'\n        [r1-start]  " n   n"    2em [r1-end]\n        [r2-start]  " c   r"    1fr [r1-end]\n                 /   1fr 20em  \n      '},children:[(0,i.jsx)("input",{...b()}),(0,i.jsxs)("div",{className:"topBar",style:{gridArea:"n",display:"flex",height:"2rem",gap:"0.1em",alignItems:"center"},children:[(0,i.jsx)(a.Z,{disabled:!(null===(u=f[m])||void 0===u?void 0:u.next),onClick:()=>v(e=>(delete e[m].next,[...e])),children:(0,i.jsx)(c.Z,{})}),(0,i.jsx)(a.Z,{disabled:!(null===(x=f[m])||void 0===x?void 0:x.next),onClick:async()=>{v(e=>{let{url:l,image:n,operation:i,data:s}=e[m].next;return delete e[m].next,setTimeout(()=>{console.log("updating selection",m,e.length),g(e.length)}),[...e,{url:l,type:"op",name:i,chain:[...e[m].chain,{parent:m,id:e.length,operation:i,data:s}],image:n}]})},children:(0,i.jsx)(o.Z,{})}),F&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("span",{children:[" ",null==F?void 0:F.width," "]}),(0,i.jsx)("span",{children:" x "}),(0,i.jsxs)("span",{children:[" ",null==F?void 0:F.height," "]})]}),(0,i.jsxs)(d.Z,{separator:">",sx:{marginLeft:"1em"},children:[(null===(h=f[m])||void 0===h?void 0:h.chain.length)>5&&(0,i.jsx)("span",{children:"..."}),null===(j=f[m])||void 0===j?void 0:j.chain.slice(-5).map((e,l)=>(0,i.jsx)(W,{onClick:()=>{g(e.id)},style:{color:"#ccc"},...e},l)),(0,i.jsx)(W,{style:{color:"#333"},...null===(p=f[m])||void 0===p?void 0:p.next})]})]}),(0,i.jsx)(N,{image:F}),(0,i.jsx)("div",{style:{gridArea:"r",display:"flex",flexDirection:"column",overflowY:"auto"},children:(0,i.jsx)(B,{disabled:k,images:f,selected:m,setSelected:g,update:S,onAddFiles:E},f.length)})]})}function V(){return(0,i.jsx)(H,{})}}},function(e){e.O(0,[655,283,620,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);